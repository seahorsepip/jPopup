function jPopup(t){function o(){W=$("html").scrollTop(),"fixed"!=$("html").css("position")&&t.overlay&&$("html").css({width:"100%",height:"100%",position:"fixed",top:-W})}function s(){"fixed"!=$("html").css("position")||$("[data-popup][data-overlay]").length||($("html").css("position","static"),$("html").scrollTop(-parseInt($("html").css("top"))),$("html").css({width:"",height:"",top:0}))}function e(){$("body").append(y).append(w),p(),n(),a(),l(),r(),v(),h(),f(),w.attr("data-position",t.position).fadeTo(t.speed,1),L=!0}function i(){x.off("mousedown touchstart"),B.off("scroll"),w.off("click mousedown touchstart mmouseup touchend"),$(window).off("resize",z),$(document).off("mousemove touchmove",M),w.fadeOut(t.speed,function(){w.remove(),s()}),y.fadeOut(t.speed,function(){y.remove()}),L=!1}function n(){t.overlay?(w.attr("data-overlay",""),y.css("z-index",w.css("z-index")).fadeIn(t.speed),o()):(w.removeAttr("data-overlay"),y.fadeOut(t.speed),s())}function l(){t.draggable?(x.css("cursor","move"),"bottom"!=t.position&&"bottomLeft"!=t.position&&"bottomRight"!=t.position&&"stretchBottom"!=t.position||!t.stickToBottom||(stickToBottom=!1,r())):x.css("cursor","inherit")}function a(){t.closeButton?Y.show():Y.hide()}function r(){switch(t.position){case"center":w.css({width:0,height:0,position:"fixed",top:"50%",left:"50%",bottom:"",right:""}),k.css({width:"",height:"",position:"relative",top:-k.outerHeight()/2,left:-k.outerWidth()/2,bottom:""})
break
case"top":w.css({width:0,height:0,position:"fixed",top:0,left:"50%",bottom:"",right:""}),k.css({width:"",height:"",position:"relative",top:0,left:-k.outerWidth()/2,bottom:""})
break
case"left":w.css({width:0,height:0,position:"fixed",top:"50%",left:0,bottom:"",right:""}),k.css({width:"",height:"",position:"relative",top:-k.outerHeight()/2,left:0,bottom:""})
break
case"bottom":w.css({width:0,height:0,position:"fixed",top:"",left:"50%",bottom:0,right:""}),"bottom"!=t.position&&"bottomLeft"!=t.position&&"bottomRight"!=t.position&&"stretchBottom"!=t.position||t.draggable?k.css({width:"",height:"",position:"relative",top:-k.outerHeight(),left:-k.outerWidth()/2,bottom:""}):k.css({position:"absolute",top:"",left:-k.outerWidth()/2,bottom:0})
break
case"right":w.css({width:0,height:0,position:"fixed",top:"50%",left:"",bottom:0,right:0}),k.css({width:"",height:"",position:"relative",top:-k.outerHeight()/2,left:-k.outerWidth(),bottom:""})
break
case"topLeft":w.css({width:0,height:0,position:"fixed",top:0,left:0,bottom:"",right:""}),k.css({width:"",height:"",position:"relative",top:0,left:0,bottom:""})
break
case"topRight":w.css({width:0,height:0,position:"fixed",top:0,left:"",bottom:"",right:0}),k.css({width:"",height:"",position:"relative",top:0,left:-k.outerWidth(),bottom:""})
break
case"bottomLeft":w.css({width:0,height:0,position:"fixed",top:"",left:"0",bottom:0,right:""}),t.stickToBottom&&!t.draggable?k.css({position:"absolute",top:"",left:0,bottom:0}):k.css({width:"",height:"",position:"relative",top:-k.outerHeight(),left:0,bottom:""})
break
case"bottomRight":w.css({width:0,height:0,position:"fixed",top:"",left:"",bottom:0,right:0}),t.stickToBottom&&!t.draggable?k.css({position:"absolute",top:"",left:-k.outerWidth(),bottom:0}):k.css({width:"",height:"",position:"relative",top:-k.outerHeight(),left:-k.outerWidth(),bottom:""})
break
case"stretchTop":w.css({width:"100%",height:0,position:"fixed",top:0,left:0,bottom:"",right:""}),k.css({width:"100%",height:"",position:"relative",top:0,left:0,bottom:""})
break
case"stretchLeft":w.css({width:0,height:"100%",position:"fixed",top:0,left:0,bottom:"",right:""}),k.css({width:"",height:"100%",position:"relative",top:0,left:0,bottom:""})
break
case"stretchBottom":w.css({width:"100%",height:0,position:"fixed",top:"",left:0,bottom:0,right:""}),t.stickToBottom&&!t.draggable?k.css({width:"100%",height:"",position:"absolute",top:"",left:0,bottom:0}):k.css({width:"100%",height:"",position:"relative",top:"",left:0,bottom:""})
break
case"stretchRight":w.css({width:0,height:"100%",position:"fixed",top:0,left:"",bottom:"",right:0}),k.css({width:"",height:"100%",position:"relative",top:0,left:-k.outerWidth(),bottom:""})
break
case"full":w.css({width:"100%",height:"100%",position:"fixed",top:0,left:0,bottom:"",right:""}),k.css({width:"100%",height:"100%",position:"relative",top:0,left:0,bottom:""})}}function c(){(t.draggable||!t.stickToBottom||"bottom"!=t.position&&"bottomLeft"!=t.position&&"bottomRight"!=t.position&&"stretchBottom"!=t.position)&&($(window).height()-k.offset().top-k.outerHeight()+$("html").scrollTop()<0&&k.offset({top:$(window).height()-k.outerHeight()+$("html").scrollTop()}),$(window).width()-k.offset().left-k.outerWidth()<0&&k.offset({left:$(window).width()-k.outerWidth()}),k.offset().top-$("html").scrollTop()<0&&(t.draggable||"bottom"!=t.position)&&k.offset({top:$("html").scrollTop()}),k.offset().left<0&&k.offset({left:0}))}function h(){var o,s
w.removeClass(t.overflowXClass+" "+t.overflowYClass),o=k.outerWidth()>$(window).width()?!0:!1,s=k.outerHeight()>$(window).height()?!0:!1,o&&w.addClass(t.overflowXClass),s&&w.addClass(t.overflowYClass)}function f(){B.scrollTop()?w.removeClass(t.scrollTopClass):w.addClass(t.scrollTopClass)
k.outerHeight()>$(window).height()?!0:!1
B.prop("scrollHeight")-B.height()-B.scrollTop()?w.removeClass(t.scrollBottomClass):w.addClass(t.scrollBottomClass)}function p(){w.css("z-index",u()+1)}function d(){var t=w.css("z-index"),o=u()
$("[data-popup]").each(function(){var o=parseInt($(this).css("z-index"))
o>t&&$(this).css("z-index",o-1)}),w.css("z-index",o)}function u(){var t=[9999]
return $("[data-popup]").each(function(){var o=parseInt($(this).css("z-index"))
o&&t.push(o)}),Math.max.apply(Math,t)}function v(o,s){"stretchTop"==t.position||"stretchLeft"==t.position||"stretchBottom"==t.position||"stretchRight"==t.position||"bottom"==t.position&&!t.draggable||(s=void 0==s?t.offset.y:s,o=void 0==o?t.offset.x:o,fY=k.offset().top,H=k.offset().left,k.offset({top:fY-s,left:H+o}),c())}function m(){var o={}
switch(t.position){case"center":case"left":case"right":o.y=w.offset().top-k.offset().top-k.outerHeight()/2
break
case"top":case"topLeft":case"topRight":case"stretchTop":case"stretchLeft":case"stretchRight":o.y=w.offset().top-k.offset().top
break
case"bottom":case"bottomLeft":case"bottomRight":case"stretchBottom":o.y=w.offset().top-k.offset().top-k.outerHeight()}switch(t.position){case"center":case"top":case"bottom":o.x=k.offset().left-w.offset().left+k.outerWidth()/2
break
case"left":case"topLeft":case"bottomLeft":case"stretchTop":case"stretchLeft":case"stretchBottom":o.x=k.offset().left-w.offset().left
break
case"right":case"topRight":case"bottomRight":case"stretchRight":o.x=k.offset().left-w.offset().left+k.outerWidth()}return o.y=Math.round(o.y),o.x=Math.floor(o.x),o}function g(){var o,s,e,i,n,l,a=""
for(o=0;o<t.buttons.length;o++)s=t.buttons[o]["class"]?" class="+t.buttons[o]["class"]:"",e=t.buttons[o].checkForm?" data-checkform=true":"",i=t.buttons[o].close===!1?" data-close="+t.buttons[o].close:"",n=void 0!==t.buttons[o].value?" data-value="+t.buttons[o].value:"",l=t.buttons[o].text||"",a+="<button"+s+i+e+n+">"+l+"</button>"
return a}function C(){return"function"==typeof document.createElement("input").checkValidity}var b,w,y,k,x,B,T,Y,L,W,H,X,_,R,z,M,E="popup",I={title:"",content:"",buttons:[],popupClass:E,wrapperClass:E+"_wrapper",overlayClass:E+"_overlay",titleClass:E+"_title",contentClass:E+"_content",buttonsClass:E+"_buttons",overflowXClass:E+"_overflow_x",overflowYClass:E+"_overflow_y",scrollTopClass:E+"_scroll_top",scrollBottomClass:E+"_scroll_bottom",closeButtonClass:E+"_close",closeButtonContent:'&times;<svg fill="#000000" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',closeButton:!1,overlay:!0,overlayClose:!1,draggable:!1,position:"center",offset:{x:0,y:0},speed:200,stickToBottom:!0,keyClose:!1}
t=$.extend(I,t),b=$('<div><div class="'+t.overlayClass+'" style="position: fixed; top: 0; left: 0; bottom: 0; right: 0; display: none;"></div><div class="'+t.wrapperClass+'" style="opacity: 0;" data-popup><form class="'+t.popupClass+'" style="position: relative; float: left;"><div class="'+t.titleClass+'">'+t.title+'</div><div class="'+t.contentClass+'">'+t.content+'</div><div class="'+t.buttonsClass+'">'+g()+'</div><div class="'+t.closeButtonClass+'">'+t.closeButtonContent+"</div></form></div></div>"),w=b.children("div:last-child"),y=b.children("div:first-child"),k=w.children("form"),x=k.children("."+t.titleClass),B=k.children("."+t.contentClass),T=k.children("."+t.buttonsClass),Y=k.children("."+t.closeButtonClass),R=!1,this.open=function(o){var s,n=$.Deferred()
return e(),s=!1,T.on("click","button",function(t){var o,e,l
t.preventDefault(),o=$(this).data("value"),e=$(this).data("checkform"),l=$(this).data("close"),C()&&e?(console.log(k[0].checkValidity()),k[0].checkValidity()?(s||n.notify(o,k),0!=l&&(i(),s=!0)):$('<input type="submit">').hide().appendTo(k).click().remove()):(s||n.notify(o,k),0!=l&&(i(),s=!0))}),Y.on("click",function(t){t.preventDefault(),i()}),B.on("scroll",function(){f()}),z=function(){c(),h(),f()},$(window).on("resize",z),x.on("mousedown touchstart",function(o){t.draggable&&(R=!0,fY=k.offset().top,H=k.offset().left,X=o.pageY||o.originalEvent.touches[0].pageY,_=o.pageX||o.originalEvent.touches[0].pageX,k.css("user-select","none"))}),M=function(o){R&&t.draggable&&(mY=void 0==o.pageY?o.originalEvent.touches[0].pageY:o.pageY,mX=void 0==o.pageX?o.originalEvent.touches[0].pageX:o.pageX,k.offset({top:fY+mY-X,left:H+mX-_}),c())},$(document).on("mousemove touchmove",M),w.on("mouseup touchend",function(o){t.draggable&&(R=!1,k.css("user-select","inherit"))}),w.on("mousedown touchstart",function(){t.draggable&&d()}),y.on("click",function(){t.overlayClose&&i()}),$(document).on("keydown",function(o){o.which==t.keyClose&&w.css("z-index")==u()&&L&&i()}),n.progress(o)},this.close=function(){return i(),this},this.addClass=function(t){return w.addClass(t),this},this.removeClass=function(t){return w.removeClass(t),this},this.title=function(o){return void 0==o?t.title:(x.html(t.fTitle),t.title=o,this)},this.content=function(o){return void 0==o?t.content:(B.html(t.fContent),t.content=o,this)},this.buttons=function(o){return void 0==o?t.buttons:(t.buttons=o,T.html(g()),this)},this.overlay=function(o){return void 0==o?t.overlay:(t.overlay=o?!0:!1,n(),this)},this.draggable=function(o){return void 0==o?t.draggable:(t.draggable=o?!0:!1,l(),this)},this.closeButton=function(o){return void 0==o?t.closeButton:(t.closebutton=o?!0:!1,a(),this)},this.popupClass=function(o){return void 0==o?t.popupClass:(k.removeClass(t.popupClass).addClass(o),t.popupClass=o,this)},this.wrapperClass=function(o){return void 0==o?t.wrapperClass:(w.removeClass(t.wrapperClass).addClass(o),t.wrapperClass=o,this)},this.overlayClass=function(o){return void 0==o?t.overlayClass:(y.removeClass(t.overlayClass).addClass(o),t.overlayClass=o,this)},this.titleClass=function(o){return void 0==o?t.titleClass:(x.removeClass(t.titleClass).addClass(o),t.titleClass=o,this)},this.contentClass=function(o){return void 0==o?t.contentClass:(B.removeClass(t.contentClass).addClass(o),t.contentClass=o,this)},this.buttonsClass=function(o){return void 0==o?t.buttonsClass:(T.removeClass(t.buttonsClass).addClass(o),t.buttonsClass=o,this)},this.overflowXClass=function(o){return void 0==o?t.overflowXClass:(w.removeClass(t.overflowXClass).addClass(o),t.overflowXClass=o,this)},this.overflowYClass=function(o){return void 0==o?t.overflowYClass:(w.removeClass(t.overflowYClass).addClass(o),t.overflowYClass=o,this)},this.scrollTopClass=function(o){return void 0==o?t.scrollTopClass:(w.removeClass(t.scrollTopClass).addClass(o),t.scrollTopClass=o,this)},this.scrollBottomClass=function(o){return void 0==o?t.scrollBottomClass:(w.removeClass(t.scrollBottomClass).addClass(o),t.scrollBottomClass=o,this)},this.closeButtonClass=function(o){return void 0==o?t.closeButtonClass:(Y.removeClass(t.closeButtonClass).addClass(o),t.closeButtonClass=o,this)},this.closeButtonContent=function(o){return void 0==fCloseButtonHTML?t.closeButtonContent:(Y.html(closeButtonContent),t.closeButtonContent=o,this)},this.speed=function(o){return void 0==fSpeed?t.speed:(t.speed=fSpeed,this)},this.position=function(o){return void 0==o?t.position:(w.removeAttr("data-position").attr("data-position",o),t.position=o,t.offset.y=0,t.offset.x=0,r(),r(),this)},this.offset=function(t){var o,s
return void 0==t?m():(o=void 0==t.y?0:t.y,s=void 0==t.x?0:t.x,v(s,o),this)},this.overlayClose=function(o){return void 0==o?t.overlayClose:(t.overlayClose=o?!0:!1,this)},this.stickToBottom=function(o){return void 0==o?t.stickToBottom:(t.stickToBottom=o?!0:!1,t.offset.y=0,t.offset.x=0,r(),r(),void 0)},this.keyClose=function(o){return void 0==o?t.keyClose:void(t.keyClose=o?o:!1)},this.popupWrapper=function(){return w},this.popupOverlay=function(){return y},this.popup=function(){return k},this.popupTitle=function(){return x},this.popupContent=function(){return B},this.popupButtons=function(){return T},this.popupClose=function(){return Y}}
